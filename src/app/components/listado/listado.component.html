<div class="container mt-4">
  <!-- Header -->
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-success mb-3">
      🔍 Encuentra Recicladores en Coquimbo
    </h1>
    <p class="lead text-muted">
      Conecta con recicladores cerca de ti y colabora por una ciudad más limpia
    </p>
  </div>

  <!-- Estados de carga -->
  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-border text-success" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando recicladores...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !cargando" class="alert alert-danger text-center">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
    <button
      class="btn btn-sm btn-outline-danger ms-3"
      (click)="cargarRecicladores()"
    >
      Reintentar
    </button>
  </div>

  <!-- Barra de Búsqueda y Filtros (SIEMPRE visible cuando hay datos) -->
  <div
    *ngIf="!cargando && !error && recicladores.length > 0"
    class="card shadow-sm mb-4"
  >
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <!-- Búsqueda por nombre -->
        <div class="col-md-5">
          <label for="busqueda" class="form-label">Buscar por nombre</label>
          <input
            type="text"
            class="form-control"
            id="busqueda"
            placeholder="Ej: María, Carlos..."
            [(ngModel)]="terminoBusqueda"
            (input)="filtrarRecicladores()"
          />
        </div>

        <!-- Filtro por materiales -->
        <div class="col-md-4">
          <label for="materialFiltro" class="form-label"
            >Filtrar por material</label
          >
          <select
            class="form-select"
            id="materialFiltro"
            [(ngModel)]="materialFiltro"
            (change)="filtrarRecicladores()"
          >
            <option value="">Todos los materiales</option>
            <option value="carton">Cartón</option>
            <option value="plastico">Plástico</option>
            <option value="vidrio">Vidrio</option>
            <option value="metal">Metal/Latas</option>
            <option value="electronico">Electrónicos</option>
            <option value="papel">Papel</option>
            <option value="otros">Otros</option>
          </select>
        </div>

        <!-- Botón limpiar -->
        <div class="col-md-2">
          <!-- Espaciador para alinear verticalmente -->
          <div class="mb-2" style="height: 1.5rem"></div>

          <button
            class="btn btn-outline-secondary w-100"
            (click)="limpiarFiltros()"
            [title]="'Limpiar todos los filtros'"
            [attr.aria-label]="'Limpiar filtros de búsqueda'"
            [disabled]="!hayFiltrosActivos"
          >
            Limpiar
            <i class="bi bi-x-circle"></i>
            <span class="visually-hidden"></span>
          </button>
        </div>

        <!-- Contador -->
        <div class="col-md-1">
          <div class="text-muted small text-center">
            <div class="d-flex align-items-center justify-content-center gap-1">
              <strong>{{ recicladoresFiltrados.length }}</strong>
              <span class="text-muted">/</span>
              <span>{{ recicladores.length }}</span>
            </div>
            <div class="extra-small mt-1">registros</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Recicladores (SIEMPRE visible cuando hay datos) -->
  <div *ngIf="!cargando && !error">
    <!-- Mensaje si no hay recicladores -->
    <div *ngIf="recicladores.length === 0" class="text-center py-5">
      <i class="bi bi-people display-1 text-muted mb-3"></i>
      <h4 class="text-muted">Aún no hay recicladores registrados</h4>
      <p class="text-muted">Sé el primero en registrarse</p>
      <button class="btn btn-success mt-2" routerLink="/perfil">
        <i class="bi bi-person-plus me-1"></i>Registrarme como Reciclador
      </button>

      <!-- Botón Volver al Home -->
      <div class="mt-3">
        <button class="btn btn-outline-secondary" routerLink="/">
          <i class="bi bi-house me-1"></i>Volver al Home
        </button>
      </div>
    </div>

    <!-- Mensaje si no hay resultados con filtros -->
    <div
      *ngIf="
        recicladores.length > 0 &&
        recicladoresFiltrados.length === 0 &&
        hayFiltrosActivos
      "
      class="text-center py-5"
    >
      <i class="bi bi-search display-1 text-muted mb-3"></i>
      <h4 class="text-muted">No se encontraron recicladores</h4>
      <p class="text-muted">Intenta con otros términos de búsqueda</p>
      <button class="btn btn-outline-secondary mt-2" (click)="limpiarFiltros()">
        <i class="bi bi-x-circle me-1"></i>Limpiar filtros
      </button>

      <!-- Botón Volver al Home -->
      <div class="mt-3">
        <button class="btn btn-outline-secondary" routerLink="/">
          <i class="bi bi-house me-1"></i>Volver al Home
        </button>
      </div>
    </div>

    <!-- Tarjetas de Recicladores -->
    <div class="row g-4" *ngIf="recicladoresFiltrados.length > 0">
      <div
        *ngFor="let reciclador of recicladoresFiltrados"
        class="col-md-6 col-lg-4"
      >
        <div class="card h-100 shadow-sm hover-shadow">
          <!-- Header de la tarjeta -->
          <div class="card-header bg-light">
            <h5 class="card-title mb-0 text-success">
              {{ reciclador.nombre }} {{ reciclador.apellido }}
            </h5>
            <small *ngIf="reciclador.retiroDomicilio" class="text-warning">
              <i class="bi bi-truck"></i> Retiro a domicilio
            </small>
          </div>

          <!-- Body de la tarjeta -->
          <div class="card-body d-flex flex-column">
            <!-- Información de contacto -->
            <div class="mb-3">
              <!-- Teléfono -->
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-telephone text-primary me-2"></i>
                <div>
                  <div class="small text-muted">Celular</div>
                  <div class="fw-semibold">{{ reciclador.telefono }}</div>
                </div>
              </div>

              <!-- Email -->
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-envelope text-primary me-2"></i>
                <div>
                  <div class="small text-muted">Correo</div>
                  <div class="fw-semibold small">{{ reciclador.email }}</div>
                </div>
              </div>

              <!-- Instagram - SOLO se muestra si existe -->
              <div
                *ngIf="reciclador.instagram"
                class="d-flex align-items-center"
              >
                <i class="bi bi-instagram text-danger me-2"></i>
                <div>
                  <div class="small text-muted">Instagram</div>
                  <div class="fw-semibold small">
                    {{ reciclador.instagram }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Materiales -->
            <div class="mt-auto">
              <h6 class="text-muted mb-2">Materiales que recicla:</h6>
              <div class="d-flex flex-wrap gap-1">
                <span
                  *ngFor="let material of reciclador.materiales"
                  class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25"
                >
                  {{ material }}
                </span>
              </div>
            </div>
          </div>

          <!-- Footer de la tarjeta -->
          <div class="card-footer bg-transparent">
            <div class="d-flex justify-content-between gap-1">
              <!-- WhatsApp -->
              <button
                class="btn btn-success btn-sm flex-fill"
                (click)="contactarReciclador(reciclador, 'whatsapp')"
                title="Enviar mensaje por WhatsApp"
              >
                <i class="bi bi-whatsapp"></i>
                <span class="d-none d-sm-inline ms-1">WhatsApp</span>
              </button>

              <!-- Instagram -->
              <button
                *ngIf="reciclador.instagram"
                class="btn btn-instagram btn-sm flex-fill"
                (click)="contactarReciclador(reciclador, 'instagram')"
                title="Ver perfil de Instagram"
              >
                <i class="bi bi-instagram"></i>
                <span class="d-none d-sm-inline ms-1">Instagram</span>
              </button>

              <!-- Email -->
              <button
                *ngIf="reciclador.email"
                class="btn btn-outline-primary btn-sm flex-fill"
                (click)="contactarReciclador(reciclador, 'email')"
                title="Enviar correo electrónico"
              >
                <i class="bi bi-envelope"></i>
                <span class="d-none d-sm-inline ms-1">Email</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Información adicional -->
  <div
    *ngIf="!cargando && !error && recicladores.length > 0"
    class="text-center mt-5 pt-4 border-top"
  >
    <p class="text-muted small">
      <i class="bi bi-recycle me-1"></i>
      ¿Eres reciclador?
      <a routerLink="/perfil" class="text-success text-decoration-none"
        >Regístrate aquí</a
      >
      para aparecer en este listado
    </p>

    <!-- Botón Volver al Home -->
    <div class="mt-3">
      <button class="btn btn-outline-secondary" routerLink="/">
        <i class="bi bi-house me-1"></i>Volver al Home
      </button>
    </div>
  </div>
</div>
